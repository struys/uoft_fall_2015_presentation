<!doctype html>
<html>
    <head>
        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="bower_components/reveal.js/css/reveal.min.css">
        <link rel="stylesheet" href="bower_components/highlightjs/styles/idea.css">
        <link rel="stylesheet" href="build/presentation.css">
        <script src="bower_components/MathJax/MathJax.js?config=AM_HTMLorMML-full"></script>

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write( '<link rel="stylesheet" href="bower_components/reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>
    </head>

    <body>
        <div class="reveal">
            <div class="slides">
                <section class="title-slide">
                    <h2 style="margin-top: 10%">Frontend Services</h2>
                    <p>@kenstruys</p>
                </section>
                <section class="center">
                    <h2>Yelp's Mission</h2>
                    <p>Connecting people with great local businesses.</p>
                    <img style="width:50%" src="assets/yelp_mission.png">
                </section>
                <section class="center">
                    <h2 class="center">People Scale >> Web Scale</h2>
                </section>
                <section class="center">
                    <h2 class="center">Development Cycle</h2>
                </section>
                <section class="center">
                    <h2 class="center">Cut a Branch</h2>
                </section>
                <section class="center">
                    <h2 class="center">Write Code</h2>
                </section>
                <section class="center">
                    <h2 class="center">Code Review</h2>
                </section>
                <section class="center">
                    <h2 class="center">Deploy To Production</h2>
                </section>
                <section class="center" data-background-image="assets/andy.gif" style="color:white; -webkit-text-stroke: 2px #111; font-size:2em;">
                    <div class="fragment">
                        <h2 class="center" style="color:white; -webkit-text-stroke: 2px #111; font-size:2em;">New Devs</h2>
                        <p class="center">Production Within A Week</p>
                    </div>
                </section>
                <section class="left-align">
                    <h2>Deployment</h2>
                    <ul>
                        <li>Make a branch with changes</li>
                        <li>Run the build/tests</li>
                        <li>Deploy to production</li>
                        <li>On failure, deploy previous version</li>
                        <li>Repeat</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>yelp-main</h2>
                    <ul>
                        <li>Primary codebase (monolith)</li>
                        <li>Mostly Python</li>
                        <li>MVC web apps</li>
                        <li>Offline batches</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>Yelp 2011</h2>
                    <ul>
                        <li>60 Developers</li>
                        <li>2 scheduled daily deploys</li>
                        <li>5 - 8 changes per deploy</li>
                        <li>20,000 Tests, 20 Selenium Tests</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>Yelp 2011-2013</h2>
                    <ul>
                        <li>60 &rarr; 200 Developers</li>
                        <li>More products, code, tests</li>
                        <li>3 Scheduled daily deploys</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>Deployments Get Scary</h2>
                    <ul>
                        <li>30+ changes per deploy</li>
                        <li>50,000 Tests, 200 Selenium Tests</li>
                        <li>No dev knows every error case</li>
                        <li>Rollbacks start to become common</li>
                    </ul>
                </section>
                <section class="center">
                    <h2 class="center" style="text-align:center; font-size:1.5em">
                        `(99/100) * 100% = 99%`
                    </h2>
                    <p>99% Chance a Branch is Bug Free</p>
                </section>
                <section class="center">
                    <h2 class="center" style="text-align:center; font-size:1.5em">
                        `(99/100 * 99/100) * 100% = 98%`
                    </h2>
                    <p>2 Bug Free Branches</p>
                </section>
                <section class="center">
                    <h2 class="center" style="text-align:center; font-size:1.5em">
                        `(99/100)^30 * 100% = 74%`
                    </h2>
                    <p>30 Bug Free Branches</p>
                </section>
                <section class="center graph">
                    <h2>This Isn't Working</h2>
                    <div class="ct-chart"></div>
                <h2 class="center" style="text-align:center; font-size:1.5em">
                    `(99/100)^n * 100%`
                </h2>
                <p class="center" style="text-align:center;">
                    `n > 500 = 0`
                </p>
                </section>
                <section class="center">
                    <h2 class="center">Search</h2>
                </section>
                <section class="left-align">
                    <h2>What is a Service?</h2>
                    <ul>
                        <li>A component that provides a service to other services</li>
                        <li>Often done via HTTP</li>
                        <li>For Example: The Facebook API</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>How to Service</h2>
                    <ul>
                        <li>Usually a separate repository</li>
                        <li>Own set of tests</li>
                        <li>Own deployment</li>
                        <li>Backwards compatible</li>
                        <li>Share code via packages</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>What is a Package?</h2>
                    <ul>
                        <li>A collection of functions/classes/values</li>
                        <li>Have their own build/tests</li>
                        <li>Packages can depend on other packages</li>
                        <li>Multiple services can depend on packages</li>
                        <li>Packages are versioned</li>
                        <li>For Example: jQuery</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>2013</h2>
                    <ul>
                        <li>Start moving backend code to services</li>
                        <li>Provide an API to our monolith</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>Backend Services are Hard</h2>
                    <ul>
                        <li>Availability</li>
                        <li>Performance</li>
                        <li>Complex Queries</li>
                    </ul>
                </section>
                <!--<section>
                    <pre><code>
    user = DB.select(…)
    business = DB.select(…)

    review = DB.select(…).where(
        business_id=business.id,
        user_id=user.id
    )

    render(user, review, business)
                    </code></pre>
                    <img style="height:300px;margin-left:auto;margin-right:auto;display: block" src="assets/darwin.png">
                </section>
                <section class="center">
                    <pre><code>
    user, business = async(
        get_user(),
        get_business()
    )

    review = get_review(
        business_id=business.id,
        user_id=user.id
    )

    render(user, review, business)
                    </code></pre>
                </section>-->
                <section class="left-align">
                    <h2>2014</h2>
                    <ul>
                        <li>~100 Production Backend Services</li>
                        <li>200 &rarr; 300 Developers</li>
                        <li>60,000 Tests, 500 Selenium Tests</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>We're Missing Something</h2>
                    <ul>
                        <li>Feature development is still slow</li>
                        <li>User impact dependant on the monolith</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>Frontend Services</h2>
                    <ul>
                        <li>Services that render HTML</li>
                        <li>Need same look and feel as existing product</li>
                        <li>Can be slightly out of sync (temporarily)</li>
                    </ul>
                </section>
               <!--<section>
                    <h2>Focus on why</h2>
                    <ul>
                        <li>We want a more stable product</li>
                        <li>We want moving to be fast</li>
                        <li>We want faster deployments</li>
                    </ul>
                </section>-->
                <section class="left-align">
                    <h2>Best Approach</h2>
                    <ul>
                        <li>Focus on making movement fast</li>
                        <li>Make libraries from existing code</li>
                        <li>Leverage backend services</li>
                        <li>Don't over engineer be agile</li>
                        <li>Should be 50% faster next time</li>
                    </ul>
                </section>
                <section class="left-align">
                    <h2>Tech Stack</h2>
                    <ul>
                        <li>Pyramid Web Framework</li>
                        <li>bower and PyPi</li>
                        <li>yelp_cheetah</li>
                        <li>libsass</li>
                    </ul>
                    <ul>
                        <li>Google Closure Compiler</li>
                        <li>pytest/karma</li>
                        <li>swagger</li>
                        <li>Jenkins/TravisCI</li>
                    </ul>
                </section>
                <section class="center">
                    <h2>Where did we start?</h2>
                </section>
                <section class="no-background center">
                    <img src="assets/google-styleguide.png">
                </section>
                <section class="no-background center">
                    <img src="assets/styleguide.png">
                </section>
                <section class="no-background center">
                    <img src="assets/brand.png">
                </section>
                <section class="no-background center">
                    <img src="assets/headers.png">
                </section>
                <section class="no-background center">
                    <img src="assets/careers.png">
                </section>
                <section class="no-background center">
                    <h2>30+ Pages Overnight</h2>
                </section>
                <section class="no-background center">
                    <img src="assets/user_details.png">
                </section>
                <section>
                    <h2>What's next?</h2>
                    <ul>
                        <li>Mobile API as a Service</li>
                        <li>Continue extracting libraries</li>
                        <li>Enable more developers</li>
                    </ul>
                </section>
                <section class="center">
                    <h2 class="center">Thanks!</h2>
                    <p>Questions?</p>
                </section>
                <section class="title-slide">
                    <img style="display:block; float:left; width:49%" src="assets/logo.png">
                    <img style="display:block; float:right; width:49%" src="assets/social.png">
                </section>
                <section>
                    <h2 class="center">yelp.com/dataset_challenge</h2>
                    <img style="display:block; float:left; width:40%" src="assets/dataset.png">
                    <div style="display:block; float:left; width:50%; font-size:0.5em; padding: 1em; line-height: 0.8em">
                        <p style="font-size:1.4em;">Academic dataset from 10 cities in 4 countries!</p>
                        <ul style="float: left; width: 50%">
                            <li>61K businesses</li>
                            <li>61K checkin-sets</li>
                            <li>481K business attributes</li>
                            <li>1.6M reviews</li>
                        </ul>
                        <ul style="float: right; width: 40%">

                            <li>366K users</li>
                            <li>2.8M edge social-graph</li>
                            <li>495K tips</li>
                        </ul>
                    </div>
                    <div class="center" style="clear: both">
                    <p>
                        Your academic project, research or visualizations, submitted by Dec 31, 2015<br>
                        =<br>
                        $5,000 prize + $1,000 for publication + $500 for presenting*<br>

                        *See full terms on website<br>
                    </p>
                    </div>
                </section>
            </div>
        </div>

        <script src="bower_components/jquery/jquery.min.js"></script>
        <script src="bower_components/reveal.js/js/reveal.min.js"></script>
        <script src="bower_components/highlightjs/highlight.pack.js"></script>
        <script src="bower_components/chartist/dist/chartist.js"></script>
        <script type="text/javascript">
            $('section')
                    .attr('data-background', "assets/background.png");
            $('section.no-background')
                    .attr('data-background', "");

            $('section.title-slide')
                .attr('data-background', "assets/title_background.png");
            Reveal.initialize({
                history: true,
                transition: 'linear',
                center: false,
                width: 1100,
                margin: 0.2,
                keyboard: {
                    39: 'next',
                    37: 'prev'
                }
            });
            $('section.left-align').css('text-align', 'left').addClass('center');
            hljs.initHighlightingOnLoad();
            $('.slide-background').css('background-position', '50% 100%');

            var drawGraph = function() {
                var series = [];
                var labels = [];
                for(var i=1; i<1000; i+=100) {
                    labels.push(i);
                    series.push(Math.floor(Math.pow((99/100), i) * 100));
                }
                new Chartist.Line('.ct-chart', {
                    labels: labels,
                    showPoint: false,
                    height: '500px',
                    series: [series]
                }, {
                    height: '200px',
                    chartPadding: {
                        right: '10px',
                        bottom: '20px'
                    },
                    showPoint: false,
                    fullWidth: true
                });
            };

            drawGraph();


            Reveal.addEventListener( 'slidechanged', function( event ) {
                if($(event.currentSlide).hasClass('graph')) {
                    drawGraph();
                }
            });


        </script>
    </body>

</html>
